---
title: Two-Factor Authentication
description: Learn about Two-Factor Auth and how to enable it for your application.
---

# Using Two-Factor Authentication (2FA)

## Introduction

Two-factor authentication (2FA) adds an extra layer of security to user accounts. The DevDojo Auth package provides built-in support for 2FA, allowing site creators to enhance the security of their application by requiring users to provide a second form of authentication.

## Enabling 2FA

### Site-Wide Activation

The site creator can choose to enable 2FA site-wide or keep it disabled. To enable 2FA site-wide, you need to configure the `settings.php` file in the `config/devdojo/auth` directory.

#### Example Configuration:

```php
return [
    '2fa' => [
        'enabled' => true,
        'secret_key_length' => 16,
    ],
];
```

### User-Level Activation

If 2FA is activated site-wide, users will have the option to enable 2FA for their individual accounts. They can visit the `/user/two-factor-authentication` page to set up 2FA.

## Setting Up 2FA for Users

### Updating User Model

To enable 2FA for users, update your user model to use the `TwoFactorAuthenticatable` trait.

#### Example User Model:

```php
use DevDojo\Auth\Traits\TwoFactorAuthenticatable;

class User extends Authenticatable
{
    use TwoFactorAuthenticatable;
}
```

### Enabling 2FA for Users

When 2FA is enabled, users can visit the `/user/two-factor-authentication` page to activate it for their accounts. This page will guide them through the process of setting up 2FA using an authenticator app like Google Authenticator.

### Generating QR Code and Secret Key

The DevDojo Auth package will generate a QR code and a secret key for the user. The user can scan the QR code using their authenticator app, which will then generate authentication codes.

#### Example Controller Method for Enabling 2FA:

```php
public function enableTwoFactorAuth(Request $request)
{
    $user = $request->user();

    // Generate QR code and secret key
    $qrCode = $user->generateTwoFactorQrCode();
    $secretKey = $user->getTwoFactorSecretKey();

    return view('two-factor-authentication.setup', compact('qrCode', 'secretKey'));
}
```

## Using 2FA for Authentication

### Logging In with 2FA

After 2FA is activated, users will be prompted to enter an authentication code after they log in. They can generate this code using their authenticator app.

#### Example Middleware for 2FA:

```php
namespace DevDojo\Auth\Http\Middleware;

use Closure;

class TwoFactorEnabled
{
    public function handle($request, Closure $next)
    {
        if ($request->user()->isTwoFactorEnabled()) {
            return redirect('/user/two-factor-authentication-challenge');
        }

        return $next($request);
    }
}
```

### Authenticating with 2FA

When the user is prompted, they will enter the authentication code generated by their authenticator app. The DevDojo Auth package will verify the code and grant access if it is correct.

#### Example Controller Method for Verifying 2FA Code:

```php
public function verifyTwoFactorAuthCode(Request $request)
{
    $request->validate(['code' => 'required|numeric']);

    $user = $request->user();

    if ($user->verifyTwoFactorAuthCode($request->code)) {
        // Code is correct, grant access
        return redirect('/home');
    }

    // Code is incorrect, redirect back with error
    return redirect()->back()->withErrors(['code' => 'The provided authentication code is incorrect.']);
}
```

## Conclusion

By enabling and configuring two-factor authentication using the DevDojo Auth package, site creators can significantly enhance the security of their application. Users will benefit from an additional layer of protection, making it harder for unauthorized individuals to gain access to their accounts.

Following these steps ensures that 2FA is properly set up and functional, providing peace of mind for both site creators and users.

